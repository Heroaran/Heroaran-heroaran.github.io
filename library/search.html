<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monster and Item Search</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; color: #222; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
    input[type=text] { width: 70%; padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 4px; background-color: #4CAF50; color: white; }
    img { max-width: 150px; margin: 10px 0; }
    .drop-item img { width: 40px; height: auto; margin-right: 10px; }
    .result-item { border-bottom: 1px solid #ddd; padding: 15px 0; }
  </style>
</head>
<body>
<div class="container">
  <h1>몬스터 및 아이템 검색</h1>
  <input type="text" id="monsterSearchInput" placeholder="몬스터 이름으로 검색 (쉼표로 구분)">
  <button onclick="searchMonsters()">검색</button>
  <input type="text" id="itemSearchInput" placeholder="아이템 이름으로 검색 (쉼표로 구분)">
  <button onclick="searchItems()">검색</button>
  <div id="results"></div>
</div>
<script>
const monsterImagePath = "images/monsters/";
const itemImagePath = "images/items/";

function sanitizeMonsterName(name) {
  return name; // 공백 및 특수문자 유지
}

function sanitizeItemName(name) {
  if (/scroll/i.test(name) && /\d+%/.test(name)) {
    const percent = name.match(/\d+%/)[0].replace('%', '');
    return "Scroll" + percent;
  }
  return name.replace(/[^a-zA-Z0-9]/g, '_');
}

function getImageElement(path, displayName, isItem = false, realFilename = null) {
  const img = document.createElement('img');
  img.alt = displayName;
  const filename = realFilename || displayName;

  img.src = path + filename + '.png';
  img.onerror = function () {
    img.onerror = function () {
      img.src = path + filename + '.gif';
    };
    img.src = path + filename + '.gif';
  };

  return img;
}

const monsters = [
  { name: "Ribbon Pig", level: 10, hp: 120, region: "Victoria Island", exp: 20, drops: ["Silver Leather Hoodwear (M)", "Dark Nightshift (M)", "Dark Nightshift Pants (M)", "[Skill Book] Triple Throw", "[Mastery Book] Genesis 20"] }
];

function searchMonsters() {
  const input = document.getElementById("monsterSearchInput").value.trim().toLowerCase();
  const results = monsters.filter(m => m.name.toLowerCase().includes(input));
  renderMonsterResults(results);
}

function searchItems() {
  const input = document.getElementById("itemSearchInput").value.trim().toLowerCase();
  const results = {};
  monsters.forEach(m => {
    m.drops.forEach(drop => {
      if (drop.toLowerCase().includes(input)) {
        if (!results[drop]) results[drop] = [];
        results[drop].push(m);
      }
    });
  });
  renderItemResults(results);
}

function renderMonsterResults(results) {
  const container = document.getElementById("results");
  container.innerHTML = '';
  results.forEach(monster => {
    const div = document.createElement('div');
    div.classList.add('result-item');
    const img = getImageElement(monsterImagePath, monster.name, false, sanitizeMonsterName(monster.name));
    div.appendChild(img);
    div.innerHTML += `
      <h3>${monster.name}</h3>
      <p><strong>Level:</strong> ${monster.level}</p>
      <p><strong>HP:</strong> ${monster.hp}</p>
      <p><strong>Region:</strong> ${monster.region}</p>
      <p><strong>EXP:</strong> ${monster.exp}</p>
      <p><strong>Drops:</strong></p>
    `;
    monster.drops.forEach(drop => {
      const dropDiv = document.createElement('div');
      dropDiv.classList.add('drop-item');
      const dropImg = getImageElement(itemImagePath, drop, true, sanitizeItemName(drop));
      dropDiv.appendChild(dropImg);
      dropDiv.innerHTML += `<span>${drop}</span>`;
      div.appendChild(dropDiv);
    });
    container.appendChild(div);
  });
}

function renderItemResults(results) {
  const container = document.getElementById("results");
  container.innerHTML = '';
  for (const [item, monsters] of Object.entries(results)) {
    const div = document.createElement('div');
    div.classList.add('result-item');
    const img = getImageElement(itemImagePath, item, true, sanitizeItemName(item));
    div.appendChild(img);
    div.innerHTML += `<h3>${item}</h3><p><strong>Dropped By:</strong></p><ul>`;
    monsters.forEach(m => {
      div.innerHTML += `<li>${m.name} (Level ${m.level}, ${m.region})</li>`;
    });
    div.innerHTML += `</ul>`;
    container.appendChild(div);
  }
}
</script>
</body>
</html>
